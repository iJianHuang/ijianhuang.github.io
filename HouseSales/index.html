<!DOCTYPE html>
<html lang="en">

<head>
    <title>Jian's ML Code Camp</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Jian's Machine Learning Code Camp">
    <meta name="keywords" content="Machine Learning TensorFlow House Price">
    <meta name="author" content="Jian Huang">
    <!-- Import the webpage's stylesheet -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../Content/Site.css">
</head>

<body>
    <h1 class="PageTitle"><a href="../index.html" target="_self">Jian's ML Code Camp </a></h1>
    <h4 class="PageHeader"></h4>

    <article>
        <h2>House Price Prediction</h2>

        <p><small>
            </small>
        </p>
        <p>
            <small>
            </small>
        </p>

       

        
    </article>

    <!-- Import TensorFlow.js library -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"></script>
    

    <!-- Import the page's JavaScript to do some stuff -->
    <script type="text/javascript">
        async function plot (pointsArray, featureName) {
            const container = { name: `${featureName} vs House Price`, tab: 'Chart 1' };
            const data = { values: [pointsArray], series: ["original"]  };
            const opts =   { xLabel: featureName, yLabel: "Price" };   
            tfvis.render.scatterplot(container, data, opts);
        }

        function normalize(tensor) {
            const min = tensor.min();
            const max = tensor.max();
            const normalizedTensor = tensor.sub(min).div(max.sub(min));
            return {
                tensor: normalizedTensor,
                min,
                max
            };
        }

        function denormalize(tensor, min, max) {
            const denormalizedTensor = tensor.mul(max.sub(min)).add(min);
            return denormalizedTensor;
        }

        async function run() {
            await tf.ready();
            
            // Import from csv
            const houseSalesDataset = tf.data.csv("https://ijianhuang.github.io/HouseSales/kc_house_data.csv")
            
            // Extract x and y from data set to plot
            const pointsDataset = houseSalesDataset.map(record => ({
                x: record.sqft_living,
                y: record.price
            }));
            const points = await pointsDataset.toArray();
            if (points.length % 2 !== 0) {
                points.pop();
            }
            tf.util.shuffle(points); // attn: in-place shuffle 
            plot(points, "Square Feet");

            // features (inputs)
            const featureValues = await points.map(p => p.x);
            const featureTensor = tf.tensor2d(featureValues, [featureValues.length, 1]);

            // labels (outputs)
            const labelValues = await points.map(p => p.y);
            const labelTensor = tf.tensor2d(labelValues, [labelValues.length, 1]);

            // normalize features and labels
            const normalizedFeature = normalize(featureTensor);
            const normalizedLabel = normalize(labelTensor);

            const [trainingFeatureTensor, testingFeatureTensor] = tf.split(normalizedFeature.tensor, 2);
            const [trainingLabelTensor, testingLabelTensor] = tf.split(normalizedLabel.tensor, 2);
            
            trainingFeatureTensor.print();
            //normalizedFeature.tensor.print();
            //normalizedLabel.tensor.print();    
            //denormalize(normalizedFeature.tensor, normalizedFeature.min, normalizedFeature.max).print();
            //const normalizedFeatureLabelTensor = normalizedFeature.tensor
            //    .concat(normalizedLabel.tensor, 1);
            //normalizedFeatureLabelTensor.print();
            //plot(await normalizedFeatureLabelTensor.array(), "Square Feet Normalized");
            //await normalizedFeatureLabelTensor.array().then(array => console.log(array));
            //const normalizedPoints = await normalizedFeatureLabelTensor
            //.array();//.then(array => array.map(i => [i[0] * 2, i[1] * 3 ]) );
            //;
            //console.log(normalizedPoints);
            //plot(normalizedPoints, "Square Feet Normalized");
            
            /*.map(record => ({
                x: record[0],
                y: record[1]
            }));
            plot(normalizedPoints, "Square Feet Normalized");
            */
            // a.array().then(array => {console.log(array[0][1]); let newArr = array.map(i => [i[0] * 2, i[1] * 3 ]); console.log(newArr); });
            //return normalizedPoints;
        }

        run();
    </script>
    
</body>

</html>